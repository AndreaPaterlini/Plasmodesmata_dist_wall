<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Alternative approaches</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Data analysis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Welcome</a>
</li>
<li>
  <a href="preliminary.html">Preliminary steps</a>
</li>
<li>
  <a href="distributions.html">Distributions</a>
</li>
<li>
  <a href="clusters.html">Clusters</a>
</li>
<li>
  <a href="surfaces.html">Surfaces</a>
</li>
<li>
  <a href="wall.html">Cell wall</a>
</li>
<li>
  <a href="Ripley.html">Alternatives</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Alternative approaches</h1>

</div>


<!-- Load Zooming library that will enable to click on images and zoom them -->
<script src="https://unpkg.com/zooming/build/zooming.min.js"></script>
<script>
// Listen to images after DOM content is fully loaded
document.addEventListener('DOMContentLoaded', function () {
new Zooming({
// options...
}).listen('.img-zoomable')
})
</script>
<p><br></p>
<p>In the paper we provided <em>one</em> pipeline for the analysis of the data generated by the plugins. Many other approaches are in principle possible and are actually warmly invited. In response to a reviewer’s suggestion, here we show an alternative strategy for the analysis of PD distributions. This approach employs Ripley’s K function implemented in the <a href="https://cran.r-project.org/web/packages/spatstat/index.html">spatstat package</a>. We highlight advantages and pitfalls. Overall, if this approach was to be implemented in the future, it will require, for precision, the spatial edges of the segmented wall and, for robustness, effect size assessments.</p>
<p><br></p>
<div id="exploring-an-example-of-real-data-at-ppp-en" class="section level1">
<h1>Exploring an example of real data at PPP-EN</h1>
<p><br></p>
<p>At this interface in the paper, using Euclidean distances and KS tests, we had detected clustering of PDs. Ripley’s K test, as shown below, seems to agree with this result. Please note that it was run on a single cell and not on the entire dataset.</p>
<p><br></p>
<pre class="r"><code>library(tidyverse)
library(broom)

setwd(&#39;./Data_individual_cells&#39;)

PPP_example_real &lt;- read_csv(&quot;170314_Col_HD_R20_339-381um_DNN_PPP1-EN_Ann.csv&quot;) %&gt;% 
      as.data.frame %&gt;% 
      select(c(LabelPositionXunits, LabelPositionYunits, LabelPositionZunits)) %&gt;% 
      rename(&quot;X_units&quot;=&quot;LabelPositionXunits&quot;) %&gt;%
      rename(&quot;Y_units&quot;=&quot;LabelPositionYunits&quot;) %&gt;%
      rename(&quot;Z_units&quot;=&quot;LabelPositionZunits&quot;) %&gt;%
      mutate(Genotype = &quot;Col-0&quot;) %&gt;%
      mutate(DatasetFilename = &quot;170314_Col_HD_R20_339-381um_DNN_PPP1-EN&quot;) %&gt;%
      mutate(Interface = &quot;PPP-EN&quot;) %&gt;%
      mutate(IterationNumber = &quot;real&quot;)

# we first perform a pca, reducing our data to a 2D situation
# we scale the data 

PPP_example_real_pca &lt;- PPP_example_real %&gt;% select(X_units, Y_units, Z_units) %&gt;% prcomp(scale. = TRUE)

# we can check that the PCA is not causing a signicant loss of information

tidy(PPP_example_real_pca, matrix = &quot;pcs&quot;) %&gt;% print() </code></pre>
<pre><code>## # A tibble: 3 x 4
##      PC std.dev percent cumulative
##   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;
## 1     1   1.54  0.785        0.785
## 2     2   0.784 0.205        0.990
## 3     3   0.172 0.00983      1</code></pre>
<pre class="r"><code># more than 90% retained in all cases in the first two dimentions

# we attach the pca columns contained in pca object to the original data
# 1 and 2 only take the first two PCAs, we are not attaching third PCA

PPP_example_real &lt;- cbind(PPP_example_real, PPP_example_real_pca$x[, 1:2])

# to use Ripley&#39;s K test we need to load the spatstat package

#install.packages(&quot;spatstat&quot;)
library(spatstat)

# we then need to create a spatial object with the ppp function that includes the x and y coordinates of the points (here PC1 and PC2) and also the overall space the points sit in. Because the the segmented wall cannot be easily imported in R here we need to use an approximation of the space obtained with max() and min() functions on PC1 and PC2
# THIS IS NOT STRICTLY SPEAKING PRECISE and it is why we favoured the Euclidean distances approach in the paper, as that approach does not require any surface information.
# Please remember this limitation is using this

PPP_example_real_pattern &lt;- ppp(PPP_example_real$PC1, PPP_example_real$PC2, c(min(PPP_example_real$PC1),max(PPP_example_real$PC1)), c(min(PPP_example_real$PC2),max(PPP_example_real$PC2)))

# we can summarise the obtained spatial area

summary(PPP_example_real_pattern)</code></pre>
<pre><code>## Planar point pattern:  129 points
## Average intensity 7.27042 points per square unit
## 
## Coordinates are given to 8 decimal places
## 
## Window: rectangle = [-2.5556158, 2.6436893] x [-1.9129159, 1.4996804] units
##                     (5.199 x 3.413 units)
## Window area = 17.7431 square units</code></pre>
<pre class="r"><code># we now run the Ripley&#39;s test
# we use envelope function rather than the Kest one alone to additionally determine the significance of the patterns. The function simulates some number of datasets (nsim = ...) by permuting the locations of input data and then obtaining the range of K values across a range of distances for each permuted dataset. The gray area obtained will represent the 95% confidence intervals for complete spatial randomness based on these simulations of data. The correction argument incorporates an edge correction with different potential models 

plot(envelope(PPP_example_real_pattern, Kest), main=&quot;Example real data at PPP-EN interface&quot;)</code></pre>
<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
## 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80,
## 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.</code></pre>
<p><img src="Ripley_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<pre class="r"><code># the black line represents our data
# the red line the theoretical spatial randomness 
# the grey area the confidence intervals as mentioned</code></pre>
<p><br></p>
</div>
<div id="exploring-simulated-data-at-the-ppp-en-interface" class="section level1">
<h1>Exploring simulated data at the PPP-EN interface</h1>
<p><br></p>
<p>Ripley’s K test does not require our simulated data. This would be a computational advantage. Nonetheless, we run the test on some simulations. We expected them to act as negative controls (as <em>we know</em> these distributions have been sampled from uniform distibutions). Here we encountered some concerns: while in some simulations (#45) the test did not detect clustering (as expected) in others (#1) weak signatures of clustering were detected.</p>
<p>This is not fully surprising as even “random” data can experience phenomena like Poisson clumping. In addition, the boundary space between the real and simulated data (and also between different simulated data for the same cell) can be slightly different due to the min() and max() functions being used. This could cause effects we don’t fully control or forecast. That is a limitation of being unable to import the segmented wall as a spatial object.</p>
<p>However, these results makes us question the direct use of Ripley’s K on real data alone. They rather suggest that employing Ripley’s K might require more quantitative assessments. For instance, one could try to calculate the K curve for each simulation and see if the curve for the real data is always above the simulated ones (arching more). We invite people interested in using this function to consider this.</p>
<p><br></p>
<pre class="r"><code>setwd(&#39;./Data_individual_cells&#39;)

PPP_example_simulated &lt;- read_csv(&quot;170314_Col_HD_R20_339-381um_DNN_PPP1-EN_random_points.csv&quot;) %&gt;% 
      as.data.frame %&gt;% 
      mutate(Genotype = &quot;Col-0&quot;) %&gt;%
      mutate(DatasetFilename = &quot;170314_Col_HD_R20_339-381um_DNN_PPP1-EN&quot;) %&gt;%
      mutate(Interface = &quot;PPP-EN&quot;)

# we now select two different simulation

PPP_example_simulated_45 &lt;- filter(PPP_example_simulated, IterationNumber==&quot;45&quot;)

PPP_example_simulated_1 &lt;- filter(PPP_example_simulated, IterationNumber==&quot;1&quot;)

PPP_example_simulated_45_pca &lt;- PPP_example_simulated_45 %&gt;% select(X_units, Y_units, Z_units) %&gt;% prcomp(scale. = TRUE)

PPP_example_simulated_1_pca &lt;- PPP_example_simulated_1 %&gt;% select(X_units, Y_units, Z_units) %&gt;% prcomp(scale. = TRUE)

tidy(PPP_example_simulated_45_pca, matrix = &quot;pcs&quot;) %&gt;% print() </code></pre>
<pre><code>## # A tibble: 3 x 4
##      PC std.dev percent cumulative
##   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;
## 1     1   1.44   0.690       0.690
## 2     2   0.943  0.296       0.986
## 3     3   0.207  0.0143      1</code></pre>
<pre class="r"><code>tidy(PPP_example_simulated_1_pca, matrix = &quot;pcs&quot;) %&gt;% print()</code></pre>
<pre><code>## # A tibble: 3 x 4
##      PC std.dev percent cumulative
##   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;
## 1     1   1.46   0.714       0.714
## 2     2   0.904  0.272       0.986
## 3     3   0.207  0.0143      1</code></pre>
<pre class="r"><code>PPP_example_simulated_45 &lt;- cbind(PPP_example_simulated_45, PPP_example_simulated_45_pca$x[, 1:2])

PPP_example_simulated_1 &lt;- cbind(PPP_example_simulated_1, PPP_example_simulated_1_pca$x[, 1:2])

PPP_example_simulated_45_pattern &lt;- ppp(PPP_example_simulated_45$PC1, PPP_example_simulated_45$PC2, c(min(PPP_example_simulated_45$PC1),max(PPP_example_simulated_45$PC1)), c(min(PPP_example_simulated_45$PC2),max(PPP_example_simulated_45$PC2)))

PPP_example_simulated_1_pattern &lt;- ppp(PPP_example_simulated_1$PC1, PPP_example_simulated_1$PC2, c(min(PPP_example_simulated_1$PC1),max(PPP_example_simulated_1$PC1)), c(min(PPP_example_simulated_1$PC2),max(PPP_example_simulated_1$PC2)))

summary(PPP_example_simulated_45_pattern)</code></pre>
<pre><code>## Planar point pattern:  129 points
## Average intensity 6.909588 points per square unit
## 
## Coordinates are given to 8 decimal places
## 
## Window: rectangle = [-2.5423422, 2.5808921] x [-2.088468, 1.5556574] units
##                     (5.123 x 3.644 units)
## Window area = 18.6697 square units</code></pre>
<pre class="r"><code>summary(PPP_example_simulated_1_pattern)</code></pre>
<pre><code>## Planar point pattern:  129 points
## Average intensity 7.287919 points per square unit
## 
## Coordinates are given to 8 decimal places
## 
## Window: rectangle = [-2.30716, 3.358493] x [-1.6954055, 1.4287757] units
##                     (5.666 x 3.124 units)
## Window area = 17.7005 square units</code></pre>
<pre class="r"><code>plot(envelope(PPP_example_simulated_45_pattern, Kest, correction=&quot;best&quot;, nsim = 1000), main=&quot;Example simulated data #45 at PPP-EN interface&quot;)</code></pre>
<pre><code>## Generating 1000 simulations of CSR  ...
## 1, 2, 3, ......10.........20.........30.........40.........50.........60........
## .70.........80.........90.........100.........110.........120.........130......
## ...140.........150.........160.........170.........180.........190.........200....
## .....210.........220.........230.........240.........250.........260.........270..
## .......280.........290.........300.........310.........320.........330.........340
## .........350.........360.........370.........380.........390.........400........
## .410.........420.........430.........440.........450.........460.........470......
## ...480.........490.........500.........510.........520.........530.........540....
## .....550.........560.........570.........580.........590.........600.........610..
## .......620.........630.........640.........650.........660.........670.........680
## .........690.........700.........710.........720.........730.........740........
## .750.........760.........770.........780.........790.........800.........810......
## ...820.........830.........840.........850.........860.........870.........880....
## .....890.........900.........910.........920.........930.........940.........950..
## .......960.........970.........980.........990......... 1000.
## 
## Done.</code></pre>
<p><img src="Ripley_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<pre class="r"><code>plot(envelope(PPP_example_simulated_1_pattern, Kest, correction=&quot;best&quot;, nsim = 1000), main=&quot;Example simulated data #1 at PPP-EN interface&quot;)</code></pre>
<pre><code>## Generating 1000 simulations of CSR  ...
## 1, 2, 3, ......10.........20.........30.........40.........50.........60........
## .70.........80.........90.........100.........110.........120.........130......
## ...140.........150.........160.........170.........180.........190.........200....
## .....210.........220.........230.........240.........250.........260.........270..
## .......280.........290.........300.........310.........320.........330.........340
## .........350.........360.........370.........380.........390.........400........
## .410.........420.........430.........440.........450.........460.........470......
## ...480.........490.........500.........510.........520.........530.........540....
## .....550.........560.........570.........580.........590.........600.........610..
## .......620.........630.........640.........650.........660.........670.........680
## .........690.........700.........710.........720.........730.........740........
## .750.........760.........770.........780.........790.........800.........810......
## ...820.........830.........840.........850.........860.........870.........880....
## .....890.........900.........910.........920.........930.........940.........950..
## .......960.........970.........980.........990......... 1000.
## 
## Done.</code></pre>
<p><img src="Ripley_files/figure-html/unnamed-chunk-2-2.png" width="672" /></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
